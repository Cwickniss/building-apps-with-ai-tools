<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Da Vinci Gear Explorer</title>
    <style>
        body {
            font-family: 'Times New Roman', serif;
            background-color: #f2e9d8;
            color: #5d4037;
            margin: 0;
            padding: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='smallGrid' width='10' height='10' patternUnits='userSpaceOnUse'%3E%3Cpath d='M 10 0 L 0 0 0 10' fill='none' stroke='%23cbbfac' stroke-width='0.5'/%3E%3C/pattern%3E%3Cpattern id='grid' width='100' height='100' patternUnits='userSpaceOnUse'%3E%3Crect width='100' height='100' fill='url(%23smallGrid)'/%3E%3Cpath d='M 100 0 L 0 0 0 100' fill='none' stroke='%23cbbfac' stroke-width='1'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='url(%23grid)' /%3E%3C/svg%3E");
        }

        #container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #8d6e63;
            padding-bottom: 20px;
            width: 100%;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #5d4037;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        h2 {
            font-size: 1.8rem;
            font-style: italic;
            color: #8d6e63;
            margin-top: 0;
        }

        #canvas-container {
            position: relative;
            border: 5px double #8d6e63;
            background-color: #e8ddcb;
            margin: 20px auto;
            width: 800px;
            height: 500px;
            box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.2);
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
        }

        #control-panel {
            background-color: #e0d2c0;
            border: 3px solid #8d6e63;
            padding: 20px;
            margin-top: 20px;
            width: 800px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .control-group {
            margin-bottom: 15px;
            width: 48%;
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            font-style: italic;
        }

        input[type="range"], input[type="number"], select {
            width: 100%;
            padding: 8px;
            background-color: #f2e9d8;
            border: 1px solid #8d6e63;
        }

        button {
            background-color: #8d6e63;
            color: #f2e9d8;
            border: none;
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            margin: 10px 5px;
            font-family: 'Times New Roman', serif;
            font-style: italic;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #5d4037;
        }

        .davinci-note {
            font-style: italic;
            font-size: 0.9rem;
            color: #8d6e63;
            margin-top: 5px;
            text-align: right;
        }

        .mirror-text {
            direction: rtl;
            unicode-bidi: bidi-override;
            font-family: 'Times New Roman', serif;
            font-style: italic;
            color: #5d4037;
            margin-top: 20px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div id="container">
        <header>
            <h1>Da Vinci Gear Explorer</h1>
            <h2>"Mechanics is the paradise of the mathematical sciences." - Leonardo da Vinci</h2>
        </header>

        <div id="canvas-container">
            <canvas id="backgroundCanvas"></canvas>
            <canvas id="gearCanvas"></canvas>
        </div>

        <div id="control-panel">
            <div class="control-group">
                <label for="drivingGearTeeth">Driving Gear Teeth:</label>
                <input type="range" id="drivingGearTeeth" min="8" max="60" value="20" step="1">
                <input type="number" id="drivingGearTeethNum" min="8" max="60" value="20">
                <div class="davinci-note">The number of teeth determines the gear ratio</div>
            </div>

            <div class="control-group">
                <label for="drivenGearTeeth">Driven Gear Teeth:</label>
                <input type="range" id="drivenGearTeeth" min="8" max="60" value="30" step="1">
                <input type="number" id="drivenGearTeethNum" min="8" max="60" value="30">
                <div class="davinci-note">Observe how teeth affect rotation speed</div>
            </div>

            <div class="control-group">
                <label for="drivingGearSpeed">Driving Gear Speed:</label>
                <input type="range" id="drivingGearSpeed" min="1" max="20" value="5" step="1">
                <input type="number" id="drivingGearSpeedNum" min="1" max="20" value="5">
                <div class="davinci-note">Velocity influences the mechanics</div>
            </div>

            <div class="control-group">
                <label for="gearSpacing">Gear Spacing:</label>
                <input type="range" id="gearSpacing" min="0" max="100" value="0" step="1">
                <input type="number" id="gearSpacingNum" min="0" max="100" value="0">
                <div class="davinci-note">Distance between gear centers</div>
            </div>

            <div class="control-group">
                <label for="gearStyle">Gear Style:</label>
                <select id="gearStyle">
                    <option value="sketch">Da Vinci Sketch</option>
                    <option value="technical">Technical Drawing</option>
                    <option value="mechanical">Mechanical</option>
                </select>
            </div>

            <div class="control-group">
                <button id="addGear">Add Third Gear</button>
                <button id="resetGears">Reset System</button>
                <button id="toggleRotation">Start/Stop Rotation</button>
            </div>

            <div style="width: 100%; margin-top: 20px;">
                <label>Gear Ratio: <span id="gearRatio">1.5</span></label>
                <div class="davinci-note">The proportion of motion between connected gears</div>
                <p class="mirror-text">
                    "Study the science of art. Study the art of science. Develop your senses – especially learn how to see. Realize that everything connects to everything else."
                </p>
            </div>
        </div>
    </div>

    <script>
        // Canvas setup
        const bgCanvas = document.getElementById('backgroundCanvas');
        const gearCanvas = document.getElementById('gearCanvas');
        const bgCtx = bgCanvas.getContext('2d');
        const gearCtx = gearCanvas.getContext('2d');

        // Set canvas size to match container
        function resizeCanvas() {
            const container = document.getElementById('canvas-container');
            const width = container.clientWidth;
            const height = container.clientHeight;
            
            bgCanvas.width = width;
            bgCanvas.height = height;
            gearCanvas.width = width;
            gearCanvas.height = height;
            
            drawBackground();
        }

        // Initialize on load and resize
        window.addEventListener('load', resizeCanvas);
        window.addEventListener('resize', resizeCanvas);

        // Gear system variables
        let gears = [];
        let isRotating = false;
        let animationId = null;
        let gearStyle = "sketch";

        // Control elements
        const drivingGearTeethSlider = document.getElementById('drivingGearTeeth');
        const drivenGearTeethSlider = document.getElementById('drivenGearTeeth');
        const drivingGearSpeedSlider = document.getElementById('drivingGearSpeed');
        const gearSpacingSlider = document.getElementById('gearSpacing');
        const gearStyleSelect = document.getElementById('gearStyle');
        const gearRatioDisplay = document.getElementById('gearRatio');
        
        const drivingGearTeethNum = document.getElementById('drivingGearTeethNum');
        const drivenGearTeethNum = document.getElementById('drivenGearTeethNum');
        const drivingGearSpeedNum = document.getElementById('drivingGearSpeedNum');
        const gearSpacingNum = document.getElementById('gearSpacingNum');

        // Gear class
        class Gear {
            constructor(x, y, radius, teeth, color, isDriving = false, angle = 0) {
                this.x = x;
                this.y = y;
                this.radius = radius;
                this.teeth = teeth;
                this.color = color;
                this.angle = angle;
                this.angularVelocity = isDriving ? 0.02 : 0;
                this.isDriving = isDriving;
                this.connected = [];
            }

            connect(gear) {
                this.connected.push(gear);
                gear.connected.push(this);
                
                // Set angular velocity based on teeth ratio
                if (this.isDriving) {
                    gear.angularVelocity = -this.angularVelocity * (this.teeth / gear.teeth);
                } else if (gear.isDriving) {
                    this.angularVelocity = -gear.angularVelocity * (gear.teeth / this.teeth);
                }
            }

            update() {
                this.angle += this.angularVelocity;
                
                // Keep angle between 0 and 2π
                if (this.angle > Math.PI * 2) {
                    this.angle -= Math.PI * 2;
                } else if (this.angle < 0) {
                    this.angle += Math.PI * 2;
                }
            }

            draw() {
                gearCtx.save();
                gearCtx.translate(this.x, this.y);
                gearCtx.rotate(this.angle);

                if (gearStyle === "sketch") {
                    this.drawDaVinciStyle();
                } else if (gearStyle === "technical") {
                    this.drawTechnicalStyle();
                } else {
                    this.drawMechanicalStyle();
                }

                gearCtx.restore();
            }

            drawDaVinciStyle() {
                gearCtx.strokeStyle = '#5d4037';
                gearCtx.lineWidth = 1;
                
                // Draw outer circle with sketch effect
                gearCtx.beginPath();
                this.sketchCircle(0, 0, this.radius);
                gearCtx.stroke();
                
                // Draw inner circle
                gearCtx.beginPath();
                this.sketchCircle(0, 0, this.radius * 0.7);
                gearCtx.stroke();
                
                // Draw center
                gearCtx.beginPath();
                this.sketchCircle(0, 0, this.radius * 0.15);
                gearCtx.stroke();
                
                // Draw teeth
                const toothDepth = this.radius * 0.2;
                for (let i = 0; i < this.teeth; i++) {
                    const angle = (i / this.teeth) * Math.PI * 2;
                    const innerX = (this.radius - toothDepth/4) * Math.cos(angle);
                    const innerY = (this.radius - toothDepth/4) * Math.sin(angle);
                    const outerX = (this.radius + toothDepth) * Math.cos(angle);
                    const outerY = (this.radius + toothDepth) * Math.sin(angle);
                    
                    gearCtx.beginPath();
                    gearCtx.moveTo(innerX, innerY);
                    gearCtx.lineTo(outerX, outerY);
                    gearCtx.stroke();
                }
                
                // Draw crosshatch for da Vinci effect
                for (let i = 0; i < 8; i++) {
                    const angle = (i / 8) * Math.PI * 2;
                    const startX = this.radius * 0.2 * Math.cos(angle);
                    const startY = this.radius * 0.2 * Math.sin(angle);
                    const endX = this.radius * 0.65 * Math.cos(angle);
                    const endY = this.radius * 0.65 * Math.sin(angle);
                    
                    gearCtx.beginPath();
                    gearCtx.moveTo(startX, startY);
                    gearCtx.lineTo(endX, endY);
                    gearCtx.stroke();
                }
            }

            drawTechnicalStyle() {
                gearCtx.strokeStyle = '#000000';
                gearCtx.lineWidth = 0.5;
                
                // Draw outer circle
                gearCtx.beginPath();
                gearCtx.arc(0, 0, this.radius, 0, Math.PI * 2);
                gearCtx.stroke();
                
                // Draw teeth
                const toothAngle = Math.PI / this.teeth;
                const toothDepth = this.radius * 0.2;
                
                gearCtx.beginPath();
                for (let i = 0; i < this.teeth; i++) {
                    const startAngle = i * 2 * toothAngle;
                    const endAngle = startAngle + toothAngle;
                    
                    const innerRadius = this.radius;
                    const outerRadius = this.radius + toothDepth;
                    
                    const startX = innerRadius * Math.cos(startAngle);
                    const startY = innerRadius * Math.sin(startAngle);
                    const outerStartX = outerRadius * Math.cos(startAngle);
                    const outerStartY = outerRadius * Math.sin(startAngle);
                    const outerEndX = outerRadius * Math.cos(endAngle);
                    const outerEndY = outerRadius * Math.sin(endAngle);
                    const endX = innerRadius * Math.cos(endAngle);
                    const endY = innerRadius * Math.sin(endAngle);
                    
                    gearCtx.moveTo(startX, startY);
                    gearCtx.lineTo(outerStartX, outerStartY);
                    gearCtx.lineTo(outerEndX, outerEndY);
                    gearCtx.lineTo(endX, endY);
                }
                gearCtx.stroke();
                
                // Draw inner circles
                gearCtx.beginPath();
                gearCtx.arc(0, 0, this.radius * 0.8, 0, Math.PI * 2);
                gearCtx.stroke();
                
                gearCtx.beginPath();
                gearCtx.arc(0, 0, this.radius * 0.2, 0, Math.PI * 2);
                gearCtx.stroke();
                
                // Draw center point
                gearCtx.beginPath();
                gearCtx.arc(0, 0, 2, 0, Math.PI * 2);
                gearCtx.fillStyle = '#000000';
                gearCtx.fill();
                
                // Draw measurement lines
                gearCtx.beginPath();
                gearCtx.moveTo(-this.radius - 20, 0);
                gearCtx.lineTo(this.radius + 20, 0);
                gearCtx.moveTo(0, -this.radius - 20);
                gearCtx.lineTo(0, this.radius + 20);
                gearCtx.stroke();
            }

            drawMechanicalStyle() {
                // Draw gear body
                gearCtx.beginPath();
                gearCtx.arc(0, 0, this.radius, 0, Math.PI * 2);
                gearCtx.fillStyle = this.color;
                gearCtx.fill();
                gearCtx.strokeStyle = '#333333';
                gearCtx.lineWidth = 2;
                gearCtx.stroke();
                
                // Draw teeth
                const toothAngle = Math.PI / this.teeth;
                const toothDepth = this.radius * 0.2;
                
                for (let i = 0; i < this.teeth; i++) {
                    const startAngle = i * 2 * toothAngle;
                    const endAngle = startAngle + toothAngle;
                    
                    const innerRadius = this.radius;
                    const outerRadius = this.radius + toothDepth;
                    
                    gearCtx.beginPath();
                    gearCtx.arc(0, 0, outerRadius, startAngle, endAngle);
                    gearCtx.arc(0, 0, innerRadius, endAngle, startAngle, true);
                    gearCtx.fillStyle = this.color;
                    gearCtx.fill();
                    gearCtx.strokeStyle = '#333333';
                    gearCtx.lineWidth = 1;
                    gearCtx.stroke();
                }
                
                // Draw inner circle
                gearCtx.beginPath();
                gearCtx.arc(0, 0, this.radius * 0.3, 0, Math.PI * 2);
                gearCtx.fillStyle = '#666666';
                gearCtx.fill();
                gearCtx.strokeStyle = '#333333';
                gearCtx.stroke();
                
                // Draw center
                gearCtx.beginPath();
                gearCtx.arc(0, 0, this.radius * 0.1, 0, Math.PI * 2);
                gearCtx.fillStyle = '#444444';
                gearCtx.fill();
            }

            // Method to create sketch-like circles
            sketchCircle(x, y, radius) {
                const segments = 36;
                const angleStep = (Math.PI * 2) / segments;
                let angle = 0;
                
                // Start at a random point on the circle
                const randomOffset = Math.random() * angleStep;
                let prevX = x + radius * Math.cos(randomOffset);
                let prevY = y + radius * Math.sin(randomOffset);
                gearCtx.moveTo(prevX, prevY);
                
                // Draw slightly imperfect segments
                for (let i = 0; i < segments; i++) {
                    angle += angleStep;
                    
                    // Add slight randomness to radius for sketch effect
                    const jitterRadius = radius * (1 + (Math.random() * 0.02 - 0.01));
                    const nextX = x + jitterRadius * Math.cos(angle);
                    const nextY = y + jitterRadius * Math.sin(angle);
                    
                    gearCtx.lineTo(nextX, nextY);
                    prevX = nextX;
                    prevY = nextY;
                }
                
                // Close the path
                gearCtx.closePath();
            }
        }

        // Initialize the gear system
        function initGears() {
            // Clear existing gears
            gears = [];
            
            // Get current control values
            const drivingTeeth = parseInt(drivingGearTeethSlider.value);
            const drivenTeeth = parseInt(drivenGearTeethSlider.value);
            const spacing = parseInt(gearSpacingSlider.value);
            
            // Calculate gear properties
            const drivingRadius = drivingTeeth * 1.5;
            const drivenRadius = drivenTeeth * 1.5;
            
            // Center coordinates
            const centerX = bgCanvas.width / 2;
            const centerY = bgCanvas.height / 2;
            
            // Calculate ideal distance between gears
            const idealDistance = drivingRadius + drivenRadius;
            const actualDistance = idealDistance + spacing;
            
            // Create driving gear
            const drivingGear = new Gear(
                centerX - actualDistance / 2,
                centerY,
                drivingRadius,
                drivingTeeth,
                'rgba(180, 155, 120, 0.7)',
                true
            );
            
            // Create driven gear
            const drivenGear = new Gear(
                centerX + actualDistance / 2,
                centerY,
                drivenRadius,
                drivenTeeth,
                'rgba(150, 125, 100, 0.7)',
                false
            );
            
            // Connect gears
            drivingGear.connect(drivenGear);
            
            // Set driving gear speed
            const speed = parseInt(drivingGearSpeedSlider.value);
            drivingGear.angularVelocity = 0.005 * speed;
            
            // Update driven gear velocity
            drivenGear.angularVelocity = -drivingGear.angularVelocity * (drivingTeeth / drivenTeeth);
            
            // Add gears to array
            gears.push(drivingGear, drivenGear);
            
            // Update gear ratio display
            updateGearRatio();
        }

        // Draw the da Vinci style background
        function drawBackground() {
            bgCtx.fillStyle = '#e8ddcb';
            bgCtx.fillRect(0, 0, bgCanvas.width, bgCanvas.height);
            
            // Draw da Vinci style grid
            bgCtx.strokeStyle = '#cbbfac';
            bgCtx.lineWidth = 0.5;
            
            // Draw horizontal grid lines
            const gridSize = 20;
            for (let y = 0; y < bgCanvas.height; y += gridSize) {
                bgCtx.beginPath();
                bgCtx.moveTo(0, y);
                bgCtx.lineTo(bgCanvas.width, y);
                bgCtx.stroke();
            }
            
            // Draw vertical grid lines
            for (let x = 0; x < bgCanvas.width; x += gridSize) {
                bgCtx.beginPath();
                bgCtx.moveTo(x, 0);
                bgCtx.lineTo(x, bgCanvas.height);
                bgCtx.stroke();
            }
            
            // Draw some da Vinci style notes and symbols
            bgCtx.font = "italic 12px 'Times New Roman'";
            bgCtx.fillStyle = '#8d6e63';
            bgCtx.textAlign = 'right';
            
            // Mirror writing like da Vinci's notebooks
            const notes = [
                'observe the motion',
                'proportion of teeth',
                'study the harmony',
                'mechanical poetry'
            ];
            
            for (let i = 0; i < notes.length; i++) {
                const x = bgCanvas.width - 50 - Math.random() * 150;
                const y = 50 + Math.random() * (bgCanvas.height - 100);
                
                // Mirror text (da Vinci style)
                const ctx = bgCtx;
                ctx.save();
                ctx.translate(x, y);
                ctx.scale(-1, 1);
                ctx.fillText(notes[i], 0, 0);
                ctx.restore();
            }
            
            // Draw some geometric figures
            bgCtx.strokeStyle = '#8d6e63';
            bgCtx.lineWidth = 0.5;
            
            // Golden rectangle
            bgCtx.beginPath();
            bgCtx.rect(30, 30, 34, 21);
            bgCtx.stroke();
            
            // Vitruvian proportions
            bgCtx.beginPath();
            bgCtx.arc(bgCanvas.width - 40, bgCanvas.height - 40, 25, 0, Math.PI * 2);
            bgCtx.stroke();
            
            bgCtx.beginPath();
            bgCtx.moveTo(bgCanvas.width - 65, bgCanvas.height - 40);
            bgCtx.lineTo(bgCanvas.width - 15, bgCanvas.height - 40);
            bgCtx.stroke();
            
            bgCtx.beginPath();
            bgCtx.moveTo(bgCanvas.width - 40, bgCanvas.height - 65);
            bgCtx.lineTo(bgCanvas.width - 40, bgCanvas.height - 15);
            bgCtx.stroke();
        }

        // Animation loop
        function animate() {
            // Clear gear canvas
            gearCtx.clearRect(0, 0, gearCanvas.width, gearCanvas.height);
            
            // Update and draw gears
            if (isRotating) {
                gears.forEach(gear => gear.update());
            }
            
            gears.forEach(gear => gear.draw());
            
            // Continue animation
            animationId = requestAnimationFrame(animate);
        }

        // Update gear ratio display
        function updateGearRatio() {
            if (gears.length >= 2) {
                const ratio = (gears[1].teeth / gears[0].teeth).toFixed(2);
                gearRatioDisplay.textContent = ratio;
            }
        }

        // Event listeners for controls
        drivingGearTeethSlider.addEventListener('input', function() {
            drivingGearTeethNum.value = this.value;
            initGears();
        });

        drivenGearTeethSlider.addEventListener('input', function() {
            drivenGearTeethNum.value = this.value;
            initGears();
        });

        drivingGearSpeedSlider.addEventListener('input', function() {
            drivingGearSpeedNum.value = this.value;
            
            if (gears.length > 0) {
                const speed = parseInt(this.value);
                gears[0].angularVelocity = 0.005 * speed;
                
                // Update connected gears
                if (gears.length > 1) {
                    gears[1].angularVelocity = -gears[0].angularVelocity * (gears[0].teeth / gears[1].teeth);
                }
            }
        });

        gearSpacingSlider.addEventListener('input', function() {
            gearSpacingNum.value = this.value;
            initGears();
        });

        // Number input handlers
        drivingGearTeethNum.addEventListener('input', function() {
            drivingGearTeethSlider.value = this.value;
            initGears();
        });

        drivenGearTeethNum.addEventListener('input', function() {
            drivenGearTeethSlider.value = this.value;
            initGears();
        });

        drivingGearSpeedNum.addEventListener('input', function() {
            drivingGearSpeedSlider.value = this.value;
            
            if (gears.length > 0) {
                const speed = parseInt(this.value);
                gears[0].angularVelocity = 0.005 * speed;
                
                // Update connected gears
                if (gears.length > 1) {
                    gears[1].angularVelocity = -gears[0].angularVelocity * (gears[0].teeth / gears[1].teeth);
                }
            }
        });

        gearSpacingNum.addEventListener('input', function() {
            gearSpacingSlider.value = this.value;
            initGears();
        });

        gearStyleSelect.addEventListener('change', function() {
            gearStyle = this.value;
        });

        document.getElementById('addGear').addEventListener('click', function() {
            if (gears.length < 3) {
                const lastGear = gears[gears.length - 1];
                const newTeeth = Math.floor((gears[0].teeth + gears[1].teeth) / 2);
                const newRadius = newTeeth * 1.5;
                
                // Position the new gear below and to the right of the driven gear
                const newX = lastGear.x + lastGear.radius + newRadius;
                const newY = lastGear.y + lastGear.radius + newRadius;
                
                const newGear = new Gear(
                    newX,
                    newY,
                    newRadius,
                    newTeeth,
                    'rgba(120, 105, 90, 0.7)'
                );
                
                // Connect to the last gear
                lastGear.connect(newGear);
                
                gears.push(newGear);
            }
        });

        document.getElementById('resetGears').addEventListener('click', function() {
            initGears();
        });

        document.getElementById('toggleRotation').addEventListener('click', function() {
            isRotating = !isRotating;
        });

        // Initialize the system
        initGears();
        
        // Start animation
        animate();
    </script>
</body>
</html>